import path from "path"
import config from "app/config"

function register(server, appId) {
  const options = config[appId]
  if (options && options.module) {
    server.connection({
      labels: [appId],
      host: config.server.host,
      port: config.server.port + options.portIndex
    })
    const appPath = options.module.indexOf("/") === -1 ? options.module : path.resolve(options.module)
    server.select(appId).register({
      register: require(appPath),
      options
    }, error => {
      if (error) {
        throw error
      }
    })
  }
}

export default register
